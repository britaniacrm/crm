{"ast":null,"code":"var _jsxFileName = \"/home/rafael/Documentos/britania/COM-front/packages/web/src/modules/vpc/containers/LineFamilyBlock/LineFamilyBlock.js\";\nimport React, { useMemo, useCallback, useState, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport filter from 'lodash/filter';\nimport find from 'lodash/find';\nimport map from 'lodash/map';\nimport Grid from '@material-ui/core/Grid';\nimport Add from '@material-ui/icons/Add';\nimport I18n, { useT } from '@britania-crm/i18n';\nimport { linesMaster as lineMasterCrmRoutes, lines as linesCrmRoutes } from '@britania-crm/services/apis/crmApi/resources/routes';\nimport useCrmApi from '@britania-crm/services/hooks/useCrmApi';\nimport Button from '@britania-crm/web-components/Button';\nimport DataTable from '@britania-crm/web-components/DataTable';\nimport InputHidden from '@britania-crm/web-components/InputHidden';\nimport InputSelect from '@britania-crm/web-components/InputSelect';\nimport Tooltip from '@britania-crm/web-components/Tooltip';\n\nconst LineFamilyBlock = ({\n  disabled,\n  formRef,\n  parentCompany\n}) => {\n  const t = useT();\n  const [linesFamilies, setLinesFamilies] = useState([]);\n  const [line, setLine] = useState('');\n  const [family, setFamily] = useState([]);\n  const [lineMaster, setLineMaster] = useState('');\n  const {\n    data: linesMasterFromApi\n  } = useCrmApi(lineMasterCrmRoutes.getAll);\n  const {\n    data: linesFromApi,\n    loading: loadingLines\n  } = useCrmApi(lineMaster ? [linesCrmRoutes.getAll, lineMaster] : null, {\n    params: {\n      lineMasterCode: lineMaster.toString()\n    }\n  });\n  const {\n    data: familiesFromApi,\n    loading: familiesFromApiLoading\n  } = useCrmApi((parentCompany === null || parentCompany === void 0 ? void 0 : parentCompany.parentCompanyCode) && line ? [linesCrmRoutes.getFamilies, parentCompany, line] : null, {\n    params: {\n      clientTotvsCode: parentCompany.parentCompanyCode,\n      lines: line\n    }\n  });\n  const columns = useMemo(() => [{\n    title: t('line', {\n      howMany: 1\n    }),\n    field: 'lineDescription'\n  }, {\n    title: t('family', {\n      howMany: 1\n    }),\n    field: 'familyDescription',\n\n    render(row) {\n      if (row === null || row === void 0 ? void 0 : row.family) {\n        const listFamilyString = map(row.family, ({\n          familyDescription\n        }) => familyDescription);\n        const shortListFamilyString = listFamilyString.slice(0, 4).join(', ');\n        return /*#__PURE__*/React.createElement(\"div\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 69,\n            columnNumber: 13\n          }\n        }, /*#__PURE__*/React.createElement(Tooltip, {\n          title: listFamilyString.join(', '),\n          arrow: true,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 70,\n            columnNumber: 15\n          }\n        }, listFamilyString.length > 4 ? shortListFamilyString.concat('...') : shortListFamilyString));\n      }\n\n      return '';\n    }\n\n  }], [t]);\n  const addDisabled = useMemo(() => !line || !family // !!find(linesFamilies, { lineCode: line, familyCode: family })\n  , [family, line]);\n  const handleLineMaster = useCallback(value => {\n    setLineMaster(value);\n\n    if (value) {\n      var _find;\n\n      formRef.current.setFieldValue('directorshipDescription', ((_find = find(linesMasterFromApi, {\n        masterLineCode: value\n      })) === null || _find === void 0 ? void 0 : _find.masterLineDescription) || '');\n    }\n  }, [formRef, linesMasterFromApi]);\n  const handleAddLineFamily = useCallback(() => {\n    const lineObj = find(linesFromApi, ({\n      lineCode\n    }) => lineCode === line);\n    const familyObj = map(family, item => {\n      const families = find(familiesFromApi, ({\n        familyCode\n      }) => familyCode === item);\n      return { ...families,\n        familyCode: Number(families === null || families === void 0 ? void 0 : families.familyCode)\n      };\n    });\n    formRef.current.setFieldValue('linesFamilies', old => [...old, {\n      family: [...familyObj],\n      ...lineObj\n    }]);\n    setFamily([]);\n    setLine('');\n  }, [family, familiesFromApi, formRef, line, linesFromApi]);\n  const handleDeleteItem = useCallback((_, row) => {\n    formRef.current.setFieldValue('linesFamilies', old => filter(old, item => {\n      if (row.lineCode === item.lineCode && row.familyCode === item.familyCode) {\n        return false;\n      }\n\n      return true;\n    }));\n  }, [formRef]);\n  useEffect(() => {\n    if (parentCompany) {\n      setFamily([]);\n    }\n  }, [parentCompany]);\n  return /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    spacing: 1,\n    style: {\n      marginBottom: 20,\n      marginTop: 20\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    md: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(InputSelect, {\n    valueKey: \"masterLineDescription\",\n    idKey: \"masterLineCode\",\n    name: \"directorshipCode\",\n    label: t('board of Directors'),\n    options: linesMasterFromApi,\n    disabled: disabled,\n    onValueChange: handleLineMaster,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(InputHidden, {\n    name: \"directorshipDescription\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    md: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(InputSelect, {\n    detached: true,\n    required: true,\n    name: \"line\",\n    label: t('line'),\n    value: line,\n    onChange: e => setLine(e.target.value),\n    valueKey: \"lineDescription\",\n    idKey: \"lineCode\",\n    options: linesFromApi,\n    loading: loadingLines,\n    disabled: disabled || !linesFromApi,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    md: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(InputSelect, {\n    detached: true,\n    required: true,\n    name: \"family\",\n    label: t('family', {\n      howMany: 1\n    }),\n    value: family,\n    onChange: e => setFamily(e.target.value),\n    valueKey: \"familyDescription\",\n    idKey: \"familyCode\",\n    options: familiesFromApi,\n    loading: familiesFromApiLoading,\n    disabled: disabled || !familiesFromApi,\n    multiple: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    md: 3,\n    style: {\n      justifyContent: 'flex-end'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(I18n, {\n    as: Button,\n    startIcon: /*#__PURE__*/React.createElement(Add, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 23\n      }\n    }),\n    variant: \"contained\",\n    color: \"primary\",\n    onClick: handleAddLineFamily,\n    disabled: disabled || addDisabled,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 9\n    }\n  }, \"datagrid body add tooltip\")), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(DataTable, {\n    data: linesFamilies,\n    columns: columns,\n    onDeleteClick: !disabled && handleDeleteItem,\n    options: {\n      search: false\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(InputHidden, {\n    name: \"linesFamilies\",\n    onValueChange: setLinesFamilies,\n    showError: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 9\n    }\n  })));\n};\n\nLineFamilyBlock.propTypes = {\n  disabled: PropTypes.bool.isRequired,\n  formRef: PropTypes.any,\n  parentCompany: PropTypes.object\n};\nLineFamilyBlock.defaultProps = {\n  formRef: {},\n  parentCompany: {}\n};\nexport default LineFamilyBlock;","map":{"version":3,"sources":["/home/rafael/Documentos/britania/COM-front/packages/web/src/modules/vpc/containers/LineFamilyBlock/LineFamilyBlock.js"],"names":["React","useMemo","useCallback","useState","useEffect","PropTypes","filter","find","map","Grid","Add","I18n","useT","linesMaster","lineMasterCrmRoutes","lines","linesCrmRoutes","useCrmApi","Button","DataTable","InputHidden","InputSelect","Tooltip","LineFamilyBlock","disabled","formRef","parentCompany","t","linesFamilies","setLinesFamilies","line","setLine","family","setFamily","lineMaster","setLineMaster","data","linesMasterFromApi","getAll","linesFromApi","loading","loadingLines","params","lineMasterCode","toString","familiesFromApi","familiesFromApiLoading","parentCompanyCode","getFamilies","clientTotvsCode","columns","title","howMany","field","render","row","listFamilyString","familyDescription","shortListFamilyString","slice","join","length","concat","addDisabled","handleLineMaster","value","current","setFieldValue","masterLineCode","masterLineDescription","handleAddLineFamily","lineObj","lineCode","familyObj","item","families","familyCode","Number","old","handleDeleteItem","_","marginBottom","marginTop","e","target","justifyContent","search","propTypes","bool","isRequired","any","object","defaultProps"],"mappings":"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","sourcesContent":["import React, {\n  useMemo,\n  useCallback,\n  useState,\n  useEffect\n} from 'react'\n\nimport PropTypes from 'prop-types'\n\nimport filter from 'lodash/filter'\nimport find from 'lodash/find'\nimport map from 'lodash/map'\n\nimport Grid from '@material-ui/core/Grid'\nimport Add from '@material-ui/icons/Add'\n\nimport I18n, { useT } from '@britania-crm/i18n'\nimport {\n  linesMaster as lineMasterCrmRoutes,\n  lines as linesCrmRoutes\n} from '@britania-crm/services/apis/crmApi/resources/routes'\nimport useCrmApi from '@britania-crm/services/hooks/useCrmApi'\nimport Button from '@britania-crm/web-components/Button'\nimport DataTable from '@britania-crm/web-components/DataTable'\nimport InputHidden from '@britania-crm/web-components/InputHidden'\nimport InputSelect from '@britania-crm/web-components/InputSelect'\nimport Tooltip from '@britania-crm/web-components/Tooltip'\n\nconst LineFamilyBlock = ({\n  disabled,\n  formRef,\n  parentCompany\n}) => {\n  const t = useT()\n  const [linesFamilies, setLinesFamilies] = useState([])\n\n  const [line, setLine] = useState('')\n  const [family, setFamily] = useState([])\n  const [lineMaster, setLineMaster] = useState('')\n\n  const { data: linesMasterFromApi } = useCrmApi(lineMasterCrmRoutes.getAll)\n\n  const { data: linesFromApi, loading: loadingLines } = useCrmApi(\n    lineMaster ? [linesCrmRoutes.getAll, lineMaster] : null,\n    { params: { lineMasterCode: lineMaster.toString() } }\n  )\n\n  const {\n    data: familiesFromApi,\n    loading: familiesFromApiLoading\n  } = useCrmApi(\n    (parentCompany?.parentCompanyCode && line) ? [linesCrmRoutes.getFamilies, parentCompany, line] : null,\n    { params: { clientTotvsCode: parentCompany.parentCompanyCode, lines: line } }\n  )\n\n  const columns = useMemo(() => [\n    {\n      title: t('line', { howMany: 1 }),\n      field: 'lineDescription'\n    },\n    {\n      title: t('family', { howMany: 1 }),\n      field: 'familyDescription',\n      render (row) {\n        if (row?.family) {\n          const listFamilyString = map(row.family, ({ familyDescription }) => familyDescription)\n          const shortListFamilyString = listFamilyString.slice(0, 4).join(', ')\n          return (\n            <div>\n              <Tooltip title={ listFamilyString.join(', ') } arrow>\n                {\n                  listFamilyString.length > 4\n                    ? shortListFamilyString.concat('...')\n                    : shortListFamilyString\n                }\n              </Tooltip>\n            </div>\n          )\n        }\n        return ''\n      }\n    }\n  ], [t])\n\n  const addDisabled = useMemo(\n    () => (\n      !line ||\n      !family\n      // !!find(linesFamilies, { lineCode: line, familyCode: family })\n    ),\n    [family, line]\n  )\n\n  const handleLineMaster = useCallback(\n    (value) => {\n      setLineMaster(value)\n      if (value) {\n        formRef.current.setFieldValue('directorshipDescription',\n          (find(linesMasterFromApi, { masterLineCode: value })?.masterLineDescription) || '')\n      }\n    },\n    [formRef, linesMasterFromApi]\n  )\n\n  const handleAddLineFamily = useCallback(\n    () => {\n      const lineObj = find(linesFromApi, ({ lineCode }) => lineCode === line)\n      const familyObj = map(family, (item) => {\n        const families = find(familiesFromApi, ({ familyCode }) => familyCode === item)\n        return {\n          ...families,\n          familyCode: Number(families?.familyCode)\n        }\n      })\n\n      formRef.current.setFieldValue('linesFamilies', (old) => [\n        ...old,\n        {\n          family: [...familyObj],\n          ...lineObj\n        }\n      ])\n\n      setFamily([])\n      setLine('')\n    },\n    [family, familiesFromApi, formRef, line, linesFromApi]\n  )\n\n  const handleDeleteItem = useCallback(\n    (_, row) => {\n      formRef.current.setFieldValue('linesFamilies', (old) => filter(old, (item) => {\n        if (row.lineCode === item.lineCode && row.familyCode === item.familyCode) {\n          return false\n        }\n        return true\n      }))\n    },\n    [formRef]\n  )\n\n  useEffect(\n    () => {\n      if (parentCompany) {\n        setFamily([])\n      }\n    },\n    [parentCompany]\n  )\n\n  return (\n    <Grid\n      container\n      spacing={ 1 }\n      style={ { marginBottom: 20, marginTop: 20 } }\n    >\n      <Grid item xs={ 12 } md={ 3 }>\n        <InputSelect\n          valueKey=\"masterLineDescription\"\n          idKey=\"masterLineCode\"\n          name=\"directorshipCode\"\n          label={ t('board of Directors') }\n          options={ linesMasterFromApi }\n          disabled={ disabled }\n          onValueChange={ handleLineMaster }\n        />\n        <InputHidden name=\"directorshipDescription\" />\n      </Grid>\n      <Grid item xs={ 12 } md={ 3 }>\n        <InputSelect\n          detached\n          required\n          name=\"line\"\n          label={ t('line') }\n          value={ line }\n          onChange={ (e) => setLine(e.target.value) }\n          valueKey=\"lineDescription\"\n          idKey=\"lineCode\"\n          options={ linesFromApi }\n          loading={ loadingLines }\n          disabled={ disabled || !linesFromApi }\n        />\n      </Grid>\n      <Grid item xs={ 12 } md={ 3 }>\n        <InputSelect\n          detached\n          required\n          name=\"family\"\n          label={ t('family', { howMany: 1 }) }\n          value={ family }\n          onChange={ (e) => setFamily(e.target.value) }\n          valueKey=\"familyDescription\"\n          idKey=\"familyCode\"\n          options={ familiesFromApi }\n          loading={ familiesFromApiLoading }\n          disabled={ disabled || !familiesFromApi }\n          multiple\n        />\n      </Grid>\n      <Grid item xs={ 12 } md={ 3 } style={ { justifyContent: 'flex-end' } }>\n        <I18n\n          as={ Button }\n          startIcon={ <Add /> }\n          variant=\"contained\"\n          color=\"primary\"\n          onClick={ handleAddLineFamily }\n          disabled={ disabled || addDisabled }\n        >\n          datagrid body add tooltip\n        </I18n>\n      </Grid>\n      <Grid item xs={ 12 }>\n        <DataTable\n          data={ linesFamilies }\n          columns={ columns }\n          onDeleteClick={ !disabled && handleDeleteItem }\n          options={ { search: false } }\n        />\n        <InputHidden\n          name=\"linesFamilies\"\n          onValueChange={ setLinesFamilies }\n          showError\n        />\n      </Grid>\n    </Grid>\n  )\n}\n\nLineFamilyBlock.propTypes = {\n  disabled: PropTypes.bool.isRequired,\n  formRef: PropTypes.any,\n  parentCompany: PropTypes.object\n}\n\nLineFamilyBlock.defaultProps = {\n  formRef: {},\n  parentCompany: {}\n}\n\nexport default LineFamilyBlock\n"]},"metadata":{},"sourceType":"module"}