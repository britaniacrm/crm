{"ast":null,"code":"var _jsxFileName = \"/home/rafael/Documentos/britania/COM-front/packages/web/src/modules/users/modals/UserProfileModal/UserProfileModal.js\";\nimport React, { useCallback, useMemo } from 'react';\nimport { useDispatch } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport isEmpty from 'lodash/isEmpty';\nimport map from 'lodash/map';\nimport { useDialog } from '@britania-crm/dialog';\nimport I18n, { useT } from '@britania-crm/i18n';\nimport { users } from '@britania-crm/services/apis/crmApi/resources/routes';\nimport useCrmApi from '@britania-crm/services/hooks/useCrmApi';\nimport { UsersActions } from '@britania-crm/stores/users';\nimport colors from '@britania-crm/styles/colors';\nimport { formatBackDateTimeToBackDateFormat } from '@britania-crm/utils/date';\nimport { formatPathToCloudStorageUrl } from '@britania-crm/utils/files';\nimport AssociatedDataList from '@britania-crm/web-components/AssociatedDataList';\nimport Button from '@britania-crm/web-components/Button';\nimport Checkbox from '@britania-crm/web-components/Checkbox';\nimport DeleteIcon from '@britania-crm/web-components/Icons/DeleteIcon';\nimport EditIcon from '@britania-crm/web-components/Icons/EditIcon';\nimport LinkIcon from '@britania-crm/web-components/Icons/LinkIcon';\nimport Image from '@britania-crm/web-components/Image';\nimport InputDateRange from '@britania-crm/web-components/InputDateRange';\nimport InputPhone from '@britania-crm/web-components/InputPhone';\nimport InputText from '@britania-crm/web-components/InputText';\nimport Modal from '@britania-crm/web-components/Modal';\nimport ConfirmModal from '@britania-crm/web-components/Modal/ConfirmModal';\nimport LinkUserProfileModal from '../LinkUserProfileModal';\nimport NewUserModal from '../NewUserModal';\nimport useStyles, { Grid, Container, ActionsAndImage } from '../styles';\n\nconst UserProfileModal = props => {\n  var _user$substituteUser, _user$file;\n\n  const {\n    id,\n    open,\n    handleClose,\n    user: externalUser,\n    onSuccess: refreshTable,\n    currentRoutePermissions\n  } = props;\n  const classes = useStyles();\n  const dispatch = useCallback(useDispatch(), []);\n  const {\n    createDialog\n  } = useDialog();\n  const t = useT();\n  const userId = useMemo(() => externalUser === null || externalUser === void 0 ? void 0 : externalUser.id, [externalUser]);\n  const {\n    data: userFromApi = {},\n    loading,\n    mutate\n  } = useCrmApi([`${users.get}/${userId}`]);\n  const user = useMemo(() => !isEmpty(userFromApi) ? userFromApi : externalUser, [externalUser, userFromApi]);\n  const attachProfile = useCallback((id, params, onSuccess, onError) => {\n    dispatch(UsersActions.attachProfiles(id, params, () => {\n      onSuccess();\n      mutate();\n      refreshTable();\n    }, onError));\n  }, [dispatch, mutate, refreshTable]);\n  const onEditClick = useCallback(() => {\n    handleClose();\n    createDialog({\n      id: 'edit-user-modal',\n      Component: NewUserModal,\n      props: {\n        userId: user.id\n      }\n    });\n  }, [createDialog, handleClose, user]);\n  const onBindClick = useCallback(() => {\n    // handleClose()\n    createDialog({\n      id: 'bind-user-profile-modal',\n      Component: LinkUserProfileModal,\n      props: {\n        username: user.username,\n        initialProfiles: map(user.userProfiles, ({\n          profileId,\n          ...profile\n        }) => ({\n          id: profileId,\n          ...profile\n        })),\n        enableLoading: true,\n\n        onSave(profiles, onSuccess, onError) {\n          const profilesId = map(profiles, item => item.id);\n          attachProfile(user.id, profilesId, onSuccess, onError);\n        }\n\n      }\n    });\n  }, [attachProfile, createDialog, user.id, user.userProfiles, user.username]);\n  const onDeleteClick = useCallback(() => createDialog({\n    id: 'delete-user-modal',\n    Component: ConfirmModal,\n    props: {\n      onConfirm() {\n        handleClose();\n        console.log('delete user', user);\n      }\n\n    }\n  }), [createDialog, handleClose, user]);\n  const represetantiveName = useMemo(() => map(userFromApi.representativeCodes, item => item.code).join(', '), [userFromApi]);\n  const substituteUserPeriod = useMemo(() => ({\n    from: user.substituteUserStartDate ? formatBackDateTimeToBackDateFormat(user.substituteUserStartDate) : '',\n    to: user.substituteUserEndDate ? formatBackDateTimeToBackDateFormat(user.substituteUserEndDate) : ''\n  }), [user.substituteUserEndDate, user.substituteUserStartDate]);\n  return /*#__PURE__*/React.createElement(Modal, {\n    id: id,\n    open: open,\n    title: t('user profile'),\n    maxWidth: \"lg\",\n    fullWidth: true,\n    loading: loading,\n    escapeWhenLoading: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    alignItems: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 8,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(InputText, {\n    detached: true,\n    name: \"username\",\n    label: t('user', {\n      howMany: 1\n    }),\n    value: user.username || '',\n    variant: \"outlined\",\n    disabled: true,\n    readOnly: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 15\n    }\n  }))), /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    alignItems: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 8,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(InputText, {\n    detached: true,\n    name: \"email\",\n    label: \"Email\",\n    value: user.email || '',\n    variant: \"outlined\",\n    disabled: true,\n    readOnly: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(InputPhone, {\n    detached: true,\n    name: \"phone\",\n    label: t('phone', {\n      howMany: 1\n    }),\n    value: user.phone || '',\n    variant: \"outlined\",\n    disabled: true,\n    readOnly: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 15\n    }\n  }))), /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    alignItems: \"center\",\n    justify: \"space-between\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Checkbox, {\n    detached: true,\n    style: {\n      marginLeft: 8\n    },\n    label: t('link representative', {\n      howMany: 1\n    }),\n    checked: !isEmpty(userFromApi.representativeCodes),\n    readOnly: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    sm: 8,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(InputText, {\n    detached: true,\n    name: \"representCode\",\n    label: \"Cod. Representante\",\n    variant: \"outlined\",\n    value: represetantiveName,\n    disabled: true,\n    readOnly: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 15\n    }\n  }))), /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    alignItems: \"center\",\n    justify: \"space-between\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    sm: 8,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(InputText, {\n    detached: true,\n    name: \"suplent\",\n    label: \"Suplente\",\n    variant: \"outlined\",\n    fullWidth: true,\n    disabled: true,\n    value: ((_user$substituteUser = user.substituteUser) === null || _user$substituteUser === void 0 ? void 0 : _user$substituteUser.username) || '',\n    readOnly: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(InputDateRange, {\n    detached: true,\n    name: \"period\",\n    width: 200,\n    InputLabelProps: {\n      shrink: true\n    },\n    readOnly: true,\n    value: substituteUserPeriod,\n    disabled: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 15\n    }\n  }))), /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    alignItems: \"center\",\n    justify: \"space-between\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(AssociatedDataList, {\n    detached: true,\n    value: user.userProfiles,\n    label: t('linked profiles'),\n    idKey: \"profileId\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 13\n    }\n  }))), /*#__PURE__*/React.createElement(ActionsAndImage, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 11\n    }\n  }, currentRoutePermissions.EDITAR && /*#__PURE__*/React.createElement(Button, {\n    className: classes.linkButton,\n    onClick: onBindClick,\n    size: \"medium\",\n    variant: \"outlined\",\n    startIcon: /*#__PURE__*/React.createElement(LinkIcon, {\n      color: colors.britSecondary.base,\n      colorHover: colors.britSecondary.base,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 29\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(I18n, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 17\n    }\n  }, \"attach\")), currentRoutePermissions.EDITAR && /*#__PURE__*/React.createElement(Button, {\n    color: \"info\",\n    onClick: onEditClick,\n    size: \"medium\",\n    variant: \"outlined\",\n    startIcon: /*#__PURE__*/React.createElement(EditIcon, {\n      color: colors.info.main,\n      colorHover: colors.info.main,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 273,\n        columnNumber: 29\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(I18n, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 275,\n      columnNumber: 17\n    }\n  }, \"edit\")), currentRoutePermissions.EXCLUIR && /*#__PURE__*/React.createElement(Button, {\n    onClick: onDeleteClick,\n    color: \"error\",\n    size: \"medium\",\n    variant: \"outlined\",\n    startIcon: /*#__PURE__*/React.createElement(DeleteIcon, {\n      color: colors.error.main,\n      colorHover: colors.error.main,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 29\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 279,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(I18n, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 286,\n      columnNumber: 17\n    }\n  }, \"exclude\"))), /*#__PURE__*/React.createElement(Image, {\n    alt: t('user profile'),\n    src: formatPathToCloudStorageUrl(user === null || user === void 0 ? void 0 : (_user$file = user.file) === null || _user$file === void 0 ? void 0 : _user$file.path),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 291,\n      columnNumber: 11\n    }\n  }))));\n};\n\nUserProfileModal.propTypes = {\n  id: PropTypes.string.isRequired,\n  open: PropTypes.bool.isRequired,\n  handleClose: PropTypes.func.isRequired,\n  user: PropTypes.object,\n  onSuccess: PropTypes.func,\n  currentRoutePermissions: PropTypes.object\n};\nUserProfileModal.defaultProps = {\n  user: {},\n\n  onSuccess() {},\n\n  currentRoutePermissions: {}\n};\nexport default UserProfileModal;","map":{"version":3,"sources":["/home/rafael/Documentos/britania/COM-front/packages/web/src/modules/users/modals/UserProfileModal/UserProfileModal.js"],"names":["React","useCallback","useMemo","useDispatch","PropTypes","isEmpty","map","useDialog","I18n","useT","users","useCrmApi","UsersActions","colors","formatBackDateTimeToBackDateFormat","formatPathToCloudStorageUrl","AssociatedDataList","Button","Checkbox","DeleteIcon","EditIcon","LinkIcon","Image","InputDateRange","InputPhone","InputText","Modal","ConfirmModal","LinkUserProfileModal","NewUserModal","useStyles","Grid","Container","ActionsAndImage","UserProfileModal","props","id","open","handleClose","user","externalUser","onSuccess","refreshTable","currentRoutePermissions","classes","dispatch","createDialog","t","userId","data","userFromApi","loading","mutate","get","attachProfile","params","onError","attachProfiles","onEditClick","Component","onBindClick","username","initialProfiles","userProfiles","profileId","profile","enableLoading","onSave","profiles","profilesId","item","onDeleteClick","onConfirm","console","log","represetantiveName","representativeCodes","code","join","substituteUserPeriod","from","substituteUserStartDate","to","substituteUserEndDate","howMany","email","phone","marginLeft","substituteUser","shrink","EDITAR","linkButton","britSecondary","base","info","main","EXCLUIR","error","file","path","propTypes","string","isRequired","bool","func","object","defaultProps"],"mappings":"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","sourcesContent":["import React, {\n  useCallback,\n  useMemo\n} from 'react'\nimport { useDispatch } from 'react-redux'\n\nimport PropTypes from 'prop-types'\n\nimport isEmpty from 'lodash/isEmpty'\nimport map from 'lodash/map'\n\nimport { useDialog } from '@britania-crm/dialog'\nimport I18n, { useT } from '@britania-crm/i18n'\nimport { users } from '@britania-crm/services/apis/crmApi/resources/routes'\nimport useCrmApi from '@britania-crm/services/hooks/useCrmApi'\nimport { UsersActions } from '@britania-crm/stores/users'\nimport colors from '@britania-crm/styles/colors'\nimport { formatBackDateTimeToBackDateFormat } from '@britania-crm/utils/date'\nimport { formatPathToCloudStorageUrl } from '@britania-crm/utils/files'\nimport AssociatedDataList from '@britania-crm/web-components/AssociatedDataList'\nimport Button from '@britania-crm/web-components/Button'\nimport Checkbox from '@britania-crm/web-components/Checkbox'\nimport DeleteIcon from '@britania-crm/web-components/Icons/DeleteIcon'\nimport EditIcon from '@britania-crm/web-components/Icons/EditIcon'\nimport LinkIcon from '@britania-crm/web-components/Icons/LinkIcon'\nimport Image from '@britania-crm/web-components/Image'\nimport InputDateRange from '@britania-crm/web-components/InputDateRange'\nimport InputPhone from '@britania-crm/web-components/InputPhone'\nimport InputText from '@britania-crm/web-components/InputText'\nimport Modal from '@britania-crm/web-components/Modal'\nimport ConfirmModal from '@britania-crm/web-components/Modal/ConfirmModal'\n\nimport LinkUserProfileModal from '../LinkUserProfileModal'\nimport NewUserModal from '../NewUserModal'\nimport useStyles, {\n  Grid,\n  Container,\n  ActionsAndImage\n} from '../styles'\n\nconst UserProfileModal = (props) => {\n  const {\n    id,\n    open,\n    handleClose,\n    user: externalUser,\n    onSuccess: refreshTable,\n    currentRoutePermissions\n  } = props\n\n  const classes = useStyles()\n  const dispatch = useCallback(useDispatch(), [])\n  const { createDialog } = useDialog()\n  const t = useT()\n\n  const userId = useMemo(() => externalUser?.id, [externalUser])\n\n  const {\n    data: userFromApi = {},\n    loading,\n    mutate\n  } = useCrmApi([`${ users.get }/${ userId }`])\n\n  const user = useMemo(\n    () => !isEmpty(userFromApi) ? userFromApi : externalUser,\n    [externalUser, userFromApi]\n  )\n\n  const attachProfile = useCallback((id, params, onSuccess, onError) => {\n    dispatch(UsersActions.attachProfiles(\n      id,\n      params,\n      () => {\n        onSuccess()\n        mutate()\n        refreshTable()\n      },\n      onError\n    ))\n  }, [dispatch, mutate, refreshTable])\n\n  const onEditClick = useCallback(\n    () => {\n      handleClose()\n      createDialog({\n        id: 'edit-user-modal',\n        Component: NewUserModal,\n        props: { userId: user.id }\n      })\n    },\n    [createDialog, handleClose, user]\n  )\n\n  const onBindClick = useCallback(\n    () => {\n      // handleClose()\n      createDialog({\n        id: 'bind-user-profile-modal',\n        Component: LinkUserProfileModal,\n        props: {\n          username: user.username,\n          initialProfiles: map(user.userProfiles, ({ profileId, ...profile }) => ({ id: profileId, ...profile })),\n          enableLoading: true,\n          onSave (profiles, onSuccess, onError) {\n            const profilesId = map(profiles, (item) => item.id)\n            attachProfile(user.id, profilesId, onSuccess, onError)\n          }\n        }\n      })\n    },\n    [attachProfile, createDialog, user.id, user.userProfiles, user.username]\n  )\n\n  const onDeleteClick = useCallback(\n    () => createDialog({\n      id: 'delete-user-modal',\n      Component: ConfirmModal,\n      props: {\n        onConfirm () {\n          handleClose()\n          console.log('delete user', user)\n        }\n      }\n    }),\n    [createDialog, handleClose, user]\n  )\n\n  const represetantiveName = useMemo(() => (\n    map(userFromApi.representativeCodes, (item) => item.code).join(', ')\n  ), [userFromApi])\n\n  const substituteUserPeriod = useMemo(\n    () => ({\n      from: user.substituteUserStartDate ? formatBackDateTimeToBackDateFormat(user.substituteUserStartDate) : '',\n      to: user.substituteUserEndDate ? formatBackDateTimeToBackDateFormat(user.substituteUserEndDate) : ''\n    }),\n    [user.substituteUserEndDate, user.substituteUserStartDate]\n  )\n\n  return (\n    <Modal\n      id={ id }\n      open={ open }\n      title={ t('user profile') }\n      maxWidth=\"lg\"\n      fullWidth\n      loading={ loading }\n      escapeWhenLoading\n    >\n      <Container>\n        <div>\n          {/* USUARIO  */}\n          <Grid container alignItems=\"center\">\n            <Grid item xs={ 8 }>\n              <InputText\n                detached\n                name=\"username\"\n                label={ t('user', { howMany: 1 }) }\n                value={ user.username || '' }\n                variant=\"outlined\"\n                disabled\n                readOnly\n              />\n            </Grid>\n          </Grid>\n\n          {/* EMAIL E TELEFONE */}\n          <Grid container alignItems=\"center\">\n            <Grid item xs={ 8 }>\n              <InputText\n                detached\n                name=\"email\"\n                label=\"Email\"\n                value={ user.email || '' }\n                variant=\"outlined\"\n                disabled\n                readOnly\n              />\n            </Grid>\n            <Grid item xs={ 4 }>\n              <InputPhone\n                detached\n                name=\"phone\"\n                label={ t('phone', { howMany: 1 }) }\n                value={ user.phone || '' }\n                variant=\"outlined\"\n                disabled\n                readOnly\n              />\n            </Grid>\n          </Grid>\n\n          {/* VINCULO E CODIGO DO REPRESENTANTE */}\n          <Grid container alignItems=\"center\" justify=\"space-between\">\n            <Checkbox\n              detached\n              style={ { marginLeft: 8 } }\n              label={ t('link representative', { howMany: 1 }) }\n              checked={ !isEmpty(userFromApi.representativeCodes) }\n              readOnly\n            />\n            <Grid item sm={ 8 }>\n              <InputText\n                detached\n                name=\"representCode\"\n                label=\"Cod. Representante\"\n                variant=\"outlined\"\n                value={ represetantiveName }\n                disabled\n                readOnly\n              />\n            </Grid>\n          </Grid>\n\n          {/* SUPLENTE, PERIODO E STATUS */}\n          <Grid container alignItems=\"center\" justify=\"space-between\">\n            <Grid item sm={ 8 }>\n              <InputText\n                detached\n                name=\"suplent\"\n                label=\"Suplente\"\n                variant=\"outlined\"\n                fullWidth\n                disabled\n                value={ user.substituteUser?.username || '' }\n                readOnly\n              />\n            </Grid>\n\n            <Grid item>\n              <InputDateRange\n                detached\n                name=\"period\"\n                width={ 200 }\n                InputLabelProps={ { shrink: true } }\n                readOnly\n                value={ substituteUserPeriod }\n                disabled\n              />\n            </Grid>\n          </Grid>\n\n          {/* PERFIS VINCULADOS */}\n          <Grid container alignItems=\"center\" justify=\"space-between\">\n            <AssociatedDataList\n              detached\n              value={ user.userProfiles }\n              label={ t('linked profiles') }\n              idKey=\"profileId\"\n            />\n          </Grid>\n        </div>\n\n        <ActionsAndImage>\n          <div>\n            {currentRoutePermissions.EDITAR && (\n              <Button\n                className={ classes.linkButton }\n                onClick={ onBindClick }\n                size=\"medium\"\n                variant=\"outlined\"\n                startIcon={ <LinkIcon color={ colors.britSecondary.base } colorHover={ colors.britSecondary.base } /> }\n              >\n                <I18n>attach</I18n>\n              </Button>\n            )}\n            {currentRoutePermissions.EDITAR && (\n              <Button\n                color=\"info\"\n                onClick={ onEditClick }\n                size=\"medium\"\n                variant=\"outlined\"\n                startIcon={ <EditIcon color={ colors.info.main } colorHover={ colors.info.main } /> }\n              >\n                <I18n>edit</I18n>\n              </Button>\n            )}\n            {currentRoutePermissions.EXCLUIR && (\n              <Button\n                onClick={ onDeleteClick }\n                color=\"error\"\n                size=\"medium\"\n                variant=\"outlined\"\n                startIcon={ <DeleteIcon color={ colors.error.main } colorHover={ colors.error.main } /> }\n              >\n                <I18n>exclude</I18n>\n              </Button>\n            )}\n          </div>\n\n          <Image\n            alt={ t('user profile') }\n            src={ formatPathToCloudStorageUrl(user?.file?.path) }\n          />\n        </ActionsAndImage>\n      </Container>\n    </Modal>\n  )\n}\n\nUserProfileModal.propTypes = {\n  id: PropTypes.string.isRequired,\n  open: PropTypes.bool.isRequired,\n  handleClose: PropTypes.func.isRequired,\n  user: PropTypes.object,\n  onSuccess: PropTypes.func,\n  currentRoutePermissions: PropTypes.object\n}\n\nUserProfileModal.defaultProps = {\n  user: {},\n  onSuccess () {},\n  currentRoutePermissions: {}\n}\n\nexport default UserProfileModal\n"]},"metadata":{},"sourceType":"module"}