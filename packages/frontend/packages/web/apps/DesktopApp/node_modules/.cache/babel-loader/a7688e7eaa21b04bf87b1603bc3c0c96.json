{"ast":null,"code":"var _jsxFileName = \"/home/rafael/Documentos/britania/COM-front/packages/web/src/modules/vpc/screens/Vpc/tabs/vpcAttachments/VpcAttachments.js\";\nimport React, { useCallback, useMemo, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport doDownloadFile from 'js-file-download';\nimport moment from 'moment/moment';\nimport PropTypes from 'prop-types';\nimport filter from 'lodash/filter';\nimport map from 'lodash/map';\nimport { useDialog } from '@britania-crm/dialog';\nimport { useT } from '@britania-crm/i18n';\nimport { VpcActions } from '@britania-crm/stores/vpc';\nimport { formatBackDateToFriendlyFormat } from '@britania-crm/utils/date';\nimport DataTable from '@britania-crm/web-components/DataTable';\nimport InputHidden from '@britania-crm/web-components/InputHidden';\nimport formFileModal from '../../../../modals/formFileModal';\nimport { Container } from './styles';\n\nconst Attachment = ({\n  disabled,\n  formRef\n}) => {\n  const t = useT();\n  const {\n    createDialog\n  } = useDialog();\n  const dispatch = useCallback(useDispatch(), []);\n  const [attachments, setAttachments] = useState([]);\n  const [loader, setLoader] = useState(false);\n  const columns = useMemo(() => [{\n    title: t('description', {\n      howMany: 1\n    }),\n    field: 'description',\n    sorting: false\n  }, {\n    title: t('date'),\n    field: 'created_at',\n    sorting: false,\n    render: row => formatBackDateToFriendlyFormat(row.created_at || moment().format())\n  }], [t]);\n  const onAddClick = useCallback(() => {\n    createDialog({\n      id: 'createFileModal',\n      Component: formFileModal,\n      props: {\n        attachments,\n        mode: 'create',\n\n        onSave(values) {\n          formRef.current.setFieldValue('attachments', old => [...old, values]);\n        }\n\n      }\n    });\n  }, [createDialog, attachments, formRef]);\n  const onEditClick = useCallback((event, row) => {\n    createDialog({\n      id: 'editFileModal',\n      Component: formFileModal,\n      props: {\n        row,\n        mode: 'edit',\n\n        onEdit(values) {\n          formRef.current.setFieldValue('attachments', old => map(old, item => {\n            var _item$tableData, _row$tableData;\n\n            if (((_item$tableData = item.tableData) === null || _item$tableData === void 0 ? void 0 : _item$tableData.id) === (row === null || row === void 0 ? void 0 : (_row$tableData = row.tableData) === null || _row$tableData === void 0 ? void 0 : _row$tableData.id)) {\n              return { ...values,\n                ...row,\n                file: values.file,\n                description: values.description,\n                created_at: moment().format('L'),\n                tableData: item.tableData\n              };\n            }\n\n            return item;\n          }));\n        }\n\n      }\n    });\n  }, [createDialog, formRef]);\n  const onViewFileClick = useCallback((event, row) => {\n    createDialog({\n      id: 'viewFileModal',\n      Component: formFileModal,\n      props: {\n        row,\n        mode: 'view'\n      }\n    });\n  }, [createDialog]);\n  const onDeleteClick = useCallback((event, row) => {\n    formRef.current.setFieldValue('attachments', old => filter(old, item => {\n      var _item$tableData2, _row$tableData2;\n\n      return ((_item$tableData2 = item.tableData) === null || _item$tableData2 === void 0 ? void 0 : _item$tableData2.id) !== ((_row$tableData2 = row.tableData) === null || _row$tableData2 === void 0 ? void 0 : _row$tableData2.id);\n    }));\n  }, [formRef]);\n  const onDownloadClick = useCallback((event, row) => {\n    var _row$file, _row$file2, _row$file3;\n\n    setLoader(true);\n    const path = (row === null || row === void 0 ? void 0 : (_row$file = row.file) === null || _row$file === void 0 ? void 0 : _row$file.path) || (row === null || row === void 0 ? void 0 : row.path);\n    const filename = (row === null || row === void 0 ? void 0 : (_row$file2 = row.file) === null || _row$file2 === void 0 ? void 0 : _row$file2.filename) || (row === null || row === void 0 ? void 0 : (_row$file3 = row.file) === null || _row$file3 === void 0 ? void 0 : _row$file3.name);\n\n    if (path) {\n      dispatch(VpcActions.downloadFileVpc(path, filename, setLoader));\n    } else {\n      doDownloadFile(row.file, filename);\n      setLoader(false);\n    }\n  }, [dispatch]);\n  return /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(DataTable, {\n    data: attachments,\n    columns: columns,\n    addTitle: t('add new {this}', {\n      gender: 'male',\n      this: t('archive', {\n        howMany: 1\n      })\n    }),\n    onAddClick: !disabled && onAddClick,\n    onEditClick: !disabled && onEditClick,\n    onDeleteClick: !disabled && onDeleteClick,\n    onDownloadClick: onDownloadClick,\n    onRowClick: onViewFileClick,\n    options: {\n      search: false\n    },\n    loading: loader,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(InputHidden, {\n    name: \"attachments\",\n    onValueChange: setAttachments,\n    showError: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 7\n    }\n  }));\n};\n\nAttachment.propTypes = {\n  disabled: PropTypes.bool.isRequired,\n  formRef: PropTypes.any.isRequired\n};\nexport default Attachment;","map":{"version":3,"sources":["/home/rafael/Documentos/britania/COM-front/packages/web/src/modules/vpc/screens/Vpc/tabs/vpcAttachments/VpcAttachments.js"],"names":["React","useCallback","useMemo","useState","useDispatch","doDownloadFile","moment","PropTypes","filter","map","useDialog","useT","VpcActions","formatBackDateToFriendlyFormat","DataTable","InputHidden","formFileModal","Container","Attachment","disabled","formRef","t","createDialog","dispatch","attachments","setAttachments","loader","setLoader","columns","title","howMany","field","sorting","render","row","created_at","format","onAddClick","id","Component","props","mode","onSave","values","current","setFieldValue","old","onEditClick","event","onEdit","item","tableData","file","description","onViewFileClick","onDeleteClick","onDownloadClick","path","filename","name","downloadFileVpc","gender","this","search","propTypes","bool","isRequired","any"],"mappings":"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","sourcesContent":["import React, {\n  useCallback,\n  useMemo,\n  useState\n} from 'react'\nimport { useDispatch } from 'react-redux'\n\nimport doDownloadFile from 'js-file-download'\nimport moment from 'moment/moment'\nimport PropTypes from 'prop-types'\n\nimport filter from 'lodash/filter'\nimport map from 'lodash/map'\n\nimport { useDialog } from '@britania-crm/dialog'\nimport { useT } from '@britania-crm/i18n'\nimport { VpcActions } from '@britania-crm/stores/vpc'\nimport { formatBackDateToFriendlyFormat } from '@britania-crm/utils/date'\nimport DataTable from '@britania-crm/web-components/DataTable'\nimport InputHidden from '@britania-crm/web-components/InputHidden'\n\nimport formFileModal from '../../../../modals/formFileModal'\nimport { Container } from './styles'\n\nconst Attachment = ({ disabled, formRef }) => {\n  const t = useT()\n  const { createDialog } = useDialog()\n  const dispatch = useCallback(useDispatch(), [])\n\n  const [attachments, setAttachments] = useState([])\n  const [loader, setLoader] = useState(false)\n\n  const columns = useMemo(() => [\n    {\n      title: t('description', { howMany: 1 }),\n      field: 'description',\n      sorting: false\n    },\n    {\n      title: t('date'),\n      field: 'created_at',\n      sorting: false,\n      render: (row) => formatBackDateToFriendlyFormat(row.created_at || moment().format())\n    }\n  ], [t])\n\n  const onAddClick = useCallback(\n    () => {\n      createDialog({\n        id: 'createFileModal',\n        Component: formFileModal,\n        props: {\n          attachments,\n          mode: 'create',\n          onSave (values) {\n            formRef.current.setFieldValue('attachments', (old) => [...old, values])\n          }\n        }\n      })\n    }, [createDialog, attachments, formRef])\n\n  const onEditClick = useCallback(\n    (event, row) => {\n      createDialog({\n        id: 'editFileModal',\n        Component: formFileModal,\n        props: {\n          row,\n          mode: 'edit',\n          onEdit (values) {\n            formRef.current.setFieldValue('attachments', (old) =>\n              map(old, (item) => {\n                if (item.tableData?.id === row?.tableData?.id) {\n                  return {\n                    ...values,\n                    ...row,\n                    file: values.file,\n                    description: values.description,\n                    created_at: moment().format('L'),\n                    tableData: item.tableData\n                  }\n                }\n                return item\n              })\n            )\n          }\n        }\n      })\n    }, [createDialog, formRef])\n\n  const onViewFileClick = useCallback(\n    (event, row) => {\n      createDialog({\n        id: 'viewFileModal',\n        Component: formFileModal,\n        props: { row, mode: 'view' }\n      })\n    }, [createDialog])\n\n  const onDeleteClick = useCallback(\n    (event, row) => {\n      formRef.current.setFieldValue('attachments', (old) => filter(old, (item) => item.tableData?.id !== row.tableData?.id))\n    },\n    [formRef]\n  )\n\n  const onDownloadClick = useCallback(\n    (event, row) => {\n      setLoader(true)\n      const path = row?.file?.path || row?.path\n      const filename = row?.file?.filename || row?.file?.name\n      if (path) {\n        dispatch(VpcActions.downloadFileVpc(path, filename, setLoader))\n      } else {\n        doDownloadFile(row.file, filename)\n        setLoader(false)\n      }\n    },\n    [dispatch]\n  )\n\n  return (\n    <Container >\n      <DataTable\n        data={ attachments }\n        columns={ columns }\n        addTitle={ t('add new {this}', { gender: 'male', this: t('archive', { howMany: 1 }) }) }\n        onAddClick={ !disabled && onAddClick }\n        onEditClick={ !disabled && onEditClick }\n        onDeleteClick={ !disabled && onDeleteClick }\n        onDownloadClick={ onDownloadClick }\n        onRowClick={ onViewFileClick }\n        options={ { search: false } }\n        loading={ loader }\n      />\n      <InputHidden name=\"attachments\" onValueChange={ setAttachments } showError/>\n    </Container>\n  )\n}\n\nAttachment.propTypes = {\n  disabled: PropTypes.bool.isRequired,\n  formRef: PropTypes.any.isRequired\n}\n\nexport default Attachment\n"]},"metadata":{},"sourceType":"module"}